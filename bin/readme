#!/usr/bin/env bash
set -euo pipefail

d=$1
D=$(printf "%02d" "$d")


# html-to-md needs some work
# it stops reading on \n when piping from curl
# but it seems to be fine when piping a file
#
# This block is from
# https://stackoverflow.com/questions/55435352/bad-file-descriptor-when-reading-from-fd-3-pointing-to-a-temp-file
# We're creating a temporary file that will delete itself when the program finishes
tmpfile=$(mktemp)
exec 3> "$tmpfile"
exec 4< "$tmpfile"
rm "$tmpfile"

curl "https://adventofcode.com/2019/day/${d}" \
  -H "cookie: session=${SESSION_ID}" \
  | pup --plain "article" \
  >&3


html-to-md <&4 > "src/Day${D}/README.md"